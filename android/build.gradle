// Top-level build file where you can add configuration options common to all sub-projects/modules.

buildscript {
  repositories {
    google()
    mavenCentral()
  }
  dependencies {
        classpath 'com.google.gms:google-services:4.4.1'
    classpath('com.android.tools.build:gradle')
    classpath('com.facebook.react:react-native-gradle-plugin')
    classpath('org.jetbrains.kotlin:kotlin-gradle-plugin')
  }
  ext {
        // 1. คืนค่าเวอร์ชันมาตรฐาน (ใช้ SDK 35 ที่เสถียรสำหรับตอนนี้)
        buildToolsVersion = "35.0.0"
        minSdkVersion = 24
        compileSdkVersion = 35
        targetSdkVersion = 35
        ndkVersion = "27.1.12297006" 
        kotlinVersion = "2.1.20" // กลับมาใช้เวอร์ชันที่ Expo รองรับ
    }
}

allprojects {
  repositories {
    google()
    mavenCentral()
    maven { url 'https://www.jitpack.io' }
  }
}

apply plugin: "expo-root-project"
apply plugin: "com.facebook.react.rootproject"

allprojects {
    configurations.all {
        resolutionStrategy {
            // บังคับให้ทุกคนใช้ Guava ตัวเดียวกัน
            force 'com.google.guava:guava:31.1-android'
            // แก้ปัญหา listenablefuture ตีกัน
            force 'com.google.guava:listenablefuture:9999.0-empty-to-avoid-conflict-with-guava'
        }
    }
}

allprojects {
    configurations.all {
        resolutionStrategy {
            // 1. บังคับ Kotlin Stdlib ให้ตรงกันทุกตัว
            force "org.jetbrains.kotlin:kotlin-stdlib:$kotlinVersion"
            force "org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlinVersion"

            // 2. ท่าไม้ตายแก้ VerifyException: จัดการ Guava และ ListenableFuture
            force 'com.google.guava:guava:31.1-android'
            
            // สั่งให้ Module listenablefuture ที่แยกออกมา "กลายร่าง" เป็นเวอร์ชันว่างเปล่า
            // เพื่อให้มันไปใช้ตัวที่ฝังอยู่ใน Guava แทน (ลดการตีกัน)
            dependencySubstitution {
                substitute module('com.google.guava:listenablefuture') using module('com.google.guava:listenablefuture:9999.0-empty-to-avoid-conflict-with-guava')
            }
        }
    }
}
